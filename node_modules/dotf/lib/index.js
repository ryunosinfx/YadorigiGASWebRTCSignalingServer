"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs_1 = require("fs");
const jsonfile_1 = require("jsonfile");
const os_1 = require("os");
const path_1 = require("path");
/**
 * Read, Write, or Exist Dotfiles
 * @param  {__dirname} dirname The relative dirname
 * @param  {string} name The dotfile name
 * @return {Dotfile} `delete`, `exists`, `read` and `write` Promises
 */
const dotf = (dirname, name) => {
    if (!name || !dirname) {
        throw new Error('Both name and dirname parameters are required');
    }
    if (dirname[0] === '~') {
        dirname = os_1.homedir();
    }
    const filename = `.${name}`;
    const fullpath = path_1.join(dirname, filename);
    return {
        exists: () => new Promise((resolve) => resolve(fs_1.existsSync(fullpath))),
        read: () => new Promise((resolve, reject) => jsonfile_1.readFile(fullpath, (err, obj) => err ? reject(err) : resolve(obj))),
        write: (obj) => new Promise((resolve, reject) => jsonfile_1.writeFile(fullpath, obj, (err) => {
            if (err) {
                reject(err);
            }
            else {
                // if a platform is not Windows(include x64)
                if ('win32' !== process.platform) {
                    // same as chmod 600
                    fs_1.chmodSync(fullpath, fs_1.constants.S_IRUSR | fs_1.constants.S_IWUSR);
                }
                resolve(obj);
            }
        })),
        delete: () => new Promise((resolve) => {
            fs_1.unlinkSync(fullpath);
            resolve();
        }),
    };
};
exports.default = dotf;
// For CommonJS default export support
module.exports = dotf;
Object.defineProperty(module.exports, 'default', { enumerable: false, value: dotf });
